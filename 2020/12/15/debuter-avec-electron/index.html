<!DOCTYPE html>
<html>


<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Débuter avec Electron &#8211; Objectivement objectif.</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Développer des applications de bureau multi plateformes en utilisant les technologies Web, tour d'horizon !&#10; &#35;Electron &#35;JavaScript &#35;NodeJS">
    <meta name="author" content="Quentin Pautrat">
    <meta name="keywords" content="Electron, JavaScript, NodeJS">
    <link rel="canonical" href="https://qpautrat.github.io/2020/12/15/debuter-avec-electron/">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/pixyll.css" type="text/css">

    <!-- Fonts -->
    <link href='//fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Lato:900,300' rel='stylesheet' type='text/css'>
    
      <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    

    <!-- Open Graph -->
    <!-- From: https://github.com/mmistakes/hpstr-jekyll-theme/blob/master/_includes/head.html -->
    <meta property="og:locale" content="fr_FR">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Débuter avec Electron">
    <meta property="og:description" content="Développer des applications de bureau multi plateformes en utilisant les technologies Web, tour d'horizon !&#10; &#35;Electron &#35;JavaScript &#35;NodeJS">
    <meta property="og:url" content="https://qpautrat.github.io/2020/12/15/debuter-avec-electron/">
    <meta property="og:site_name" content="Objectivement objectif.">
    
      <meta property="og:image" content="https://qpautrat.github.io/assets/electron.svg">
    

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@qpautrat" />
    <meta name="twitter:title" content="Débuter avec Electron" />
    <meta name="twitter:description" content="Développer des applications de bureau multi plateformes en utilisant les technologies Web, tour d'horizon !&#10; &#35;Electron &#35;JavaScript &#35;NodeJS" />
    
      <meta name="twitter:image" content="https://qpautrat.github.io/assets/electron.svg" />
    

    <!-- Icons -->
    <link rel="apple-touch-icon" sizes="57x57" href="https://qpautrat.github.io/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="114x114" href="https://qpautrat.github.io/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="https://qpautrat.github.io/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="144x144" href="https://qpautrat.github.io/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="60x60" href="https://qpautrat.github.io/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="120x120" href="https://qpautrat.github.io/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="https://qpautrat.github.io/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="152x152" href="https://qpautrat.github.io/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://qpautrat.github.io/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="https://qpautrat.github.io/favicon-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="https://qpautrat.github.io/favicon-160x160.png" sizes="160x160">
    <link rel="icon" type="image/png" href="https://qpautrat.github.io/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="https://qpautrat.github.io/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="https://qpautrat.github.io/favicon-32x32.png" sizes="32x32">
</head>

<body class="">
  <div class="site-wrap">
    <header class="site-header px2 px-responsive">
  <div class="mt2 wrap">
    <div class="measure">
      <a href="https://qpautrat.github.io" class="site-title">Objectivement objectif.</a>
      <nav class="site-nav right">
        
      </nav>
      <div class="clearfix"></div>
      
        <div class="social-icons">
  <div class="left">
    
      <a class="fa fa-github" href="https://github.com/qpautrat"></a>
    
    
    <a class="fa fa-rss" href="/feed.xml"></a>
    
      <a class="fa fa-twitter" href="https://twitter.com/qpautrat"></a>
    
    
    
    
      <a class="fa fa-linkedin" href="https://www.linkedin.com/in/qpautrat"></a>
    
  </div>
  <div class="right">
    
    
    
  </div>
</div>
<div class="clearfix"></div>

      
    </div>
  </div>
</header>


    <div class="post p2 p-responsive wrap" role="main">
      <div class="measure">
        


<div class="post-header mb2">
  <h1>Débuter avec Electron</h1>
  <span class="post-meta">Dec 15, 2020</span><br>
  
  <span class="post-meta small">16 minute read</span>
  
    <span class="post-meta small">#Electron #JavaScript #NodeJS</span><br>
  
</div>

<article class="post-content">
  <p>Développé et maintenu par Github, Electron est un framework qui permet de développer des <strong>applications de bureau multi plateformes</strong> (OSX, Windows, Linux) en <strong>utilisant les technologies web</strong>, HTML, CSS et JavaScript. Il embarque NodeJS pour le runtime et le moteur de rendu de Chromium pour le rendu graphique. Electron offre en plus une API qui sert d’abstraction pour interagir avec le système d’exploitation.</p>

<p>Comme fil rouge j’ai décidé de développer un <a href="https://cloudinary.com/dam-guide/dam">Digital Asset Management ou DAM</a>. Je vais développer deux fonctionnalités très simples. Importer un Asset dans l’application et visualiser les Assets déjà importés.</p>

<h2 id="créer-et-lancer-lapplication">Créer et lancer l’application</h2>

<p>J’utilise le <em>builder</em> <a href="https://www.electronforge.io">Electron Forge</a> pour créer le projet. <a href="https://www.electronjs.org/docs/tutorial/boilerplates-and-clis#boilerplates-and-clis">Il en existe d’autres</a>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npx create-electron-app electron-dam
<span class="nb">cd </span>electron-dam
</code></pre></div></div>

<p>Forge met à disposition des <em><a href="https://www.electronforge.io/templates/typescript-+-webpack-template">Templates</a></em> afin de commencer avec plus d’outils comme par exemple Webpack et TypeScript.</p>

<p>Je lance l’application:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm start
</code></pre></div></div>

<p><img src="/assets/electron-hello-world.png" alt="Electron Hello World !" /></p>

<p>Je peux voir plusieurs choses assez cool. Mon application ressemble à n’importe quelle autre: un titre, un menu, le rendu visuel de ma première page web et même une DevToolBar !</p>

<p>J’ai testé sur Ubuntu 20.04, Windows 10, OSX Catalina.</p>

<p>Ma première impression est très bonne. C’est très simple d’avoir un premier déliverable.</p>

<h2 id="bootstraping">Bootstraping</h2>

<p>Je regarde ce que contient le projet.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">//</span><span class="w"> </span><span class="err">package.json</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"main"</span><span class="p">:</span><span class="w"> </span><span class="s2">"src/index.js"</span><span class="p">,</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Comme toute application NodeJS, <em>main</em> spécifie le point d’entrée de l’application.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">//</span><span class="w"> </span><span class="err">package.json</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"start"</span><span class="p">:</span><span class="w"> </span><span class="s2">"electron-forge start"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"package"</span><span class="p">:</span><span class="w"> </span><span class="s2">"electron-forge package"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"make"</span><span class="p">:</span><span class="w"> </span><span class="s2">"electron-forge make"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"publish"</span><span class="p">:</span><span class="w"> </span><span class="s2">"electron-forge publish"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"lint"</span><span class="p">:</span><span class="w"> </span><span class="s2">"echo </span><span class="se">\"</span><span class="s2">No linting configured</span><span class="se">\"</span><span class="s2">"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="err">...</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Forge met à disposition <a href="https://www.electronforge.io/cli#commands">plusieurs commandes</a> utiles pour développer et publier son application.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">//</span><span class="w"> </span><span class="err">package.json</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"forge"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"makers"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w">
	            </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"@electron-forge/maker-squirrel"</span><span class="p">,</span><span class="w">
	            </span><span class="nl">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
		        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"electron_dam"</span><span class="w">
	            </span><span class="p">}</span><span class="w">
	        </span><span class="p">},</span><span class="w">
	        </span><span class="p">{</span><span class="w">
	            </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"@electron-forge/maker-zip"</span><span class="p">,</span><span class="w">
	            </span><span class="nl">"platforms"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
	                </span><span class="s2">"darwin"</span><span class="w">
	            </span><span class="p">]</span><span class="w">
	        </span><span class="p">},</span><span class="w">
	        </span><span class="p">{</span><span class="w">
	            </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"@electron-forge/maker-deb"</span><span class="p">,</span><span class="w">
	            </span><span class="nl">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
	        </span><span class="p">},</span><span class="w">
	        </span><span class="p">{</span><span class="w">
	            </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"@electron-forge/maker-rpm"</span><span class="p">,</span><span class="w">
	            </span><span class="nl">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
	        </span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Forge propose par défaut plusieurs <em><a href="https://www.electronforge.io/config/makers">Makers</a></em> qui permettent de créer des distribuables spécifiques à chaque platforme.</p>

<p>Il y a aussi une section <em><a href="https://www.electronforge.io/config/plugins">Plugins</a></em>, qui permet d’étendre les fonctionnalités de Forge. Par exemple il est possible de profiter de Webpack avec le Hot Module Reload.</p>

<p>Le fichier <em>index.js</em> est très bien commenté et l’API d’Electron est simple à appréhender. J’ai très rapidement compris le contenu du fichier.</p>

<p>Les fichiers <em>index.html</em> et <em>index.css</em> contiennent la partie visuelle de mon application comme une application web classique.</p>

<p>Si je modifie le HTML ou le CSS je ne suis pas obligé de relancer l’application. Je peux rafraichir la page avec Ctrl+R pour voir les modifications.</p>

<p>Il est possible d’ajouter du Javascript:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">&lt;</span><span class="err">!--</span> <span class="na">index</span><span class="err">.</span><span class="na">html</span> <span class="err">--</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
    document.getElementsByTagName('h1')[0].addEventListener("click", (event) =&gt; <span class="si">{</span> 
	<span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">Welcome !</span><span class="dl">'</span><span class="p">);</span>
    <span class="si">}</span>);
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</code></pre></div></div>

<p><img src="/assets/electron-welcome.png" alt="Electron Welcome !" /></p>

<p>Cependant si je veux changer par exemple la taille de ma fenêtre:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">mainWindow</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BrowserWindow</span><span class="p">({</span>
  <span class="na">width</span><span class="p">:</span> <span class="mi">1200</span><span class="p">,</span>
  <span class="na">height</span><span class="p">:</span> <span class="mi">800</span><span class="p">,</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Je suis obligé de relancer mon application.</p>

<p>⚠️ <strong>Le fichier index.js est exécuté par NodeJS alors que les fichiers html et css sont eux interprétés par le navigateur. Le fichier index.js fait office de Backend tandis que le html fait office de Frontend.</strong></p>

<h2 id="importer-un-asset">Importer un Asset</h2>

<p>Afin de stocker les Assets et être en mesure de jouer avec je dois d’abord définir un répertoire de référence sur l’ordinateur de l’utilisateur.</p>

<h3 id="initialiser-le-répertoire-de-stockage">Initialiser le répertoire de stockage</h3>

<p>Au lancement de l’application je vais vérifier si le dossier existe. Si non je vais le créer. J’ai décidé de choisir arbitrairement le dossier de destination. Dans le futur je pourrais laisser le choix à l’utilisateur.</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// index.js - Main process</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">app</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">electron</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">path</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">fs</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">assetsFolder</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">getPath</span><span class="p">(</span><span class="dl">'</span><span class="s1">documents</span><span class="dl">'</span><span class="p">),</span> <span class="dl">'</span><span class="s1">/electron-dam-assets</span><span class="dl">'</span>
<span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">fs</span><span class="p">.</span><span class="nx">existsSync</span><span class="p">(</span><span class="nx">assetsFolder</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">fs</span><span class="p">.</span><span class="nx">mkdirSync</span><span class="p">(</span><span class="nx">assetsFolder</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>La méthode <em><a href="https://www.electronjs.org/docs/all#appgetpathname">app.getPath</a></em> offre plusieurs options possibles. D’un point de vue développeur elle permet de s’abstraire de l’OS sur lequel l’application est exécutée.</p>

<p>Après avoir relancer mon application, je vérifie qu’il existe maintenant un dossier <em>electron-dam-assets</em> dans mes Documents:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls</span> <span class="nt">-al</span> ~/Documents
</code></pre></div></div>

<h3 id="ajouter-un-menu">Ajouter un menu</h3>

<p>Comme intéraction je propose à l’utilisateur un menu d’application supplémentaire <em>Asset</em>. Par défaut Electron initialise un menu. Lorsque l’application est <em><a href="https://www.electronjs.org/docs/all#event-ready">ready</a></em> il est possible de le modifier via l’API <em><a href="https://www.electronjs.org/docs/api/menu">Menu</a></em> et <em><a href="https://www.electronjs.org/docs/api/menu-item">MenuItem</a></em>. Lorsque l’utilisateur va cliquer sur <em>Import</em> l’application va lui ouvrir une fenêtre pour sélectionner un fichier sur son ordinateur. Tout comme <em>Menu</em> et <em>MenuItem</em>, l’objet <em><a href="https://www.electronjs.org/docs/api/dialog">dialog</a></em> permet de faire cela sans se soucier de l’OS.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// index.js</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Menu</span><span class="p">,</span> <span class="nx">MenuItem</span><span class="p">,</span> <span class="nx">dialog</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">electron</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">ready</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">menu</span> <span class="o">=</span> <span class="nx">Menu</span><span class="p">.</span><span class="nx">getApplicationMenu</span><span class="p">();</span>
  <span class="nx">menu</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="k">new</span> <span class="nx">MenuItem</span><span class="p">({</span>
    <span class="dl">'</span><span class="s1">label</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Asset</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">submenu</span><span class="dl">'</span><span class="p">:</span> <span class="p">[{</span> 
      <span class="dl">'</span><span class="s1">label</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Import</span><span class="dl">'</span><span class="p">,</span>
      <span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    	  <span class="kd">let</span> <span class="nx">filepaths</span> <span class="o">=</span> <span class="nx">dialog</span><span class="p">.</span><span class="nx">showOpenDialogSync</span><span class="p">({</span> 
          <span class="na">properties</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">openFile</span><span class="dl">'</span><span class="p">]</span> 
        <span class="p">});</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">filepaths</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}]</span>
  <span class="p">}));</span>
  <span class="nx">Menu</span><span class="p">.</span><span class="nx">setApplicationMenu</span><span class="p">(</span><span class="nx">menu</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<p><img src="/assets/electron-menu.png" alt="Electron Menu" /></p>

<p><img src="/assets/electron-dialog.png" alt="Electron dialog" /></p>

<h3 id="sauvegarder-le-fichier">Sauvegarder le fichier</h3>

<p>J’ajoute une fonction <em>importAsset</em> pour copier le fichier sélectionné par l’utilisateur dans le dossier d’Assets.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="nx">importAsset</span><span class="p">(</span><span class="nx">filepaths</span><span class="p">.</span><span class="nx">shift</span><span class="p">());</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">importAsset</span> <span class="o">=</span> <span class="p">(</span><span class="nx">filepath</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">filename</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">basename</span><span class="p">(</span><span class="nx">filepath</span><span class="p">);</span>
  <span class="kd">let</span> <span class="nx">newFilepath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">assetsFolder</span><span class="p">,</span> <span class="nx">filename</span><span class="p">);</span>
  <span class="nx">fs</span><span class="p">.</span><span class="nx">copyFile</span><span class="p">(</span><span class="nx">filepath</span><span class="p">,</span> <span class="nx">newFilepath</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
  <span class="p">})</span>
<span class="p">}</span>
</code></pre></div></div>
<p>En testant la fonctionnalité je m’assure que l’Asset a bien été importé:</p>

<p><img src="/assets/electron-asset-saved.png" alt="Electron asset saved !" /></p>

<h2 id="afficher-la-liste-des-assets">Afficher la liste des Assets</h2>

<p>La prochaine étape est maintenant d’afficher les Assets importés sur la fenêtre principale.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- index.html --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"assets"</span><span class="nt">&gt;&lt;/div&gt;</span>
</code></pre></div></div>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">//</span> <span class="nt">index</span><span class="nc">.css</span>
<span class="nf">#assets</span> <span class="p">{</span>
  <span class="nl">display</span><span class="p">:</span> <span class="n">grid</span><span class="p">;</span>
  <span class="py">grid-template-columns</span><span class="p">:</span> <span class="nb">repeat</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">1</span><span class="n">fr</span><span class="p">);</span>
  <span class="py">grid-gap</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.asset</span> <span class="p">{</span>
  <span class="nl">background-color</span><span class="p">:</span> <span class="no">tomato</span><span class="p">;</span>
  <span class="nl">width</span><span class="p">:</span> <span class="m">200px</span><span class="p">;</span>
  <span class="nl">height</span><span class="p">:</span> <span class="m">200px</span><span class="p">;</span>
  <span class="nl">border</span><span class="p">:</span> <span class="no">black</span> <span class="nb">solid</span> <span class="m">2px</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Pour chaque instance de <em><a href="https://www.electronjs.org/docs/api/browser-window#new-browserwindowoptions">BrowserWindow</a></em> est associé un <strong>processus de rendu (renderer proces)</strong>. J’ajoute deux options à la création de ma fenêtre principale. Je vais d’abord autorisé l’integration de NodeJS dans ce processus de rendu et je lui passe le chemin vers le dossier d’assets. C’est une des façons de communiquer entre le <strong>processus principal (main process)</strong> et un processus de rendu. J’explique dans le chapitre suivant la notion de processus dans Electron qui est très importante.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// index.js</span>
<span class="kd">const</span> <span class="nx">mainWindow</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BrowserWindow</span><span class="p">({</span>
	<span class="p">...</span>
  <span class="na">webPreferences</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">nodeIntegration</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">additionalArguments</span><span class="p">:</span> <span class="p">[</span><span class="nx">assetsFolder</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Dans mon script coté client je vais récupérer le chemin du dossier de mes Assets. Ensuite pour chaque fichier dans ce dossier je vais ajouter un nouvel élément <em><img /></em> dans mon HTML avec pour attribut <em>src</em> le chemin vers le fichier.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// index.html</span>
<span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">path</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">fs</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">assets</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">assets</span><span class="dl">'</span><span class="p">)</span>
<span class="nx">assets</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">assetsFolder</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="nx">fs</span><span class="p">.</span><span class="nx">readdir</span><span class="p">(</span><span class="nx">assetsFolder</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">files</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Unable to scan directory: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span> 
    <span class="nx">files</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">file</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">img</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">img</span><span class="dl">"</span><span class="p">);</span>
        <span class="nx">img</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">assetsFolder</span><span class="p">,</span> <span class="nx">file</span><span class="p">);</span>
        <span class="nx">img</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">asset</span><span class="dl">"</span><span class="p">;</span>
        <span class="nx">assets</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">img</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Si je relance l’application je devrais être en mesure de voir les Assets que j’ai déjà importé !</p>

<p><img src="/assets/electron-asset-list.png" alt="Electron asset list" /></p>

<p>J’ai terminé l’implémentation des deux fonctionnalités. Je vais maintenant expliquer quelques concepts que j’estime extrêmement important à saisir.</p>

<h2 id="le-système-de-processus">Le système de Processus</h2>

<p>Electron a deux types de processus.</p>

<h3 id="mainprocess">MainProcess</h3>

<p>Il n’y a qu’un seul processus principal. Le <em>MainProcess</em> va servir principalement à créer des pages web à l’aide de <em>BrowserWindow</em> et à interagir avec le système grâce à NodeJS et à l’API d’Electron. C’est l’idée de <strong>Backend</strong> auquel je faisais référence un peu plus tôt.</p>

<h3 id="renderer-process">Renderer process</h3>

<p>Pour chaque instance de <em>BrowserWindow</em> (donc pour chaque page web) Electron associe un processus de rendu <em>RendererProcess</em>. Il peut donc y avoir autant de processus de rendu que de page web. Quand l’instance de <em>BrowserWindow</em> est détruite, le processus de rendu est lui aussi détruit. Le processus de rendu a pour but d’intéragir avec l’utilisateur. L’idée est de capter une action et de fournir un visuel adéquat. Le <em>RendererProcess</em> a accès aux API web classiques.</p>

<p><a href="https://www.electronjs.org/docs/tutorial/quick-start#main-and-renderer-processes">Plus d’informations sur la documentation.</a></p>

<h2 id="sécurité">Sécurité</h2>

<p>J’ai rendu possible l’accès à NodeJS depuis le processus de rendu pour faciliter l’implémentation.</p>

<p>⚠️ <strong>Donner l’accès à NodeJS au processus de rendu est très pratique mais rend mon application totalement vulnérable</strong>. Si par exemple je charge du contenu distant (ce qui arrive souvent) j’expose mon système à des attaques de type injection XSS.</p>

<p><strong>Par défaut, <a href="https://www.electronjs.org/docs/tutorial/security#2-do-not-enable-nodejs-integration-for-remote-content">Electron désactive l’intégration de NodeJS</a> dans le processus de rendu et respecte <a href="https://en.wikipedia.org/wiki/Principle_of_least_privilege">le principe du moindre privilège</a>.</strong></p>

<p>La documentation officielle fournit une <a href="https://www.electronjs.org/docs/tutorial/security#checklist-security-recommendations">liste de recommandations</a> à propos de la sécurité des applications.</p>

<p>Si il est très déconseillé de laisser la possibilité au processus de rendu d’accéder au système, comment notre <strong>Frontend</strong> va t’il pouvoir communiquer avec notre <strong>Backend</strong> comme on pourrait le faire en Web avec des appels HTTP ?</p>

<h2 id="ipc-inter-processes-communication">IPC (Inter-Processes Communication)</h2>

<p>Pour que les deux processus communiquent, l’API d’Electron met à disposition deux modules <em>IpcMain</em> et <em>IpcRenderer.</em></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">ipcRenderer</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">channel</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span> <span class="c1">// Send data to main process</span>
<span class="nx">ipcRenderer</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">channel</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="p">...</span><span class="nx">args</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">func</span><span class="p">(...</span><span class="nx">args</span><span class="p">));</span> <span class="c1">// Receive data from main process</span>

<span class="nx">ipcMain</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">channel</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="p">...</span><span class="nx">args</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">func</span><span class="p">(...</span><span class="nx">args</span><span class="p">));</span> <span class="c1">// Receive data from a renderer process</span>
<span class="nx">BrowserWindow</span><span class="p">.</span><span class="nx">webContents</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">channel</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span> <span class="c1">//Send data to a specific renderer process</span>
</code></pre></div></div>

<p>Puisque <em>ipcRenderer</em> fait partie de l’API Electron, il n’est pas possible de l’utiliser depuis le processus de rendu. Il manque une dernière étape que les développeurs d’Electron ont implémenté sous forme de <em>preloading</em>.</p>

<p>Lorsque l’on créé une nouvelle page web on peut exécuter un script de <em>preload</em>:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// index.js</span>
<span class="kd">const</span> <span class="nx">mainWindow</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BrowserWindow</span><span class="p">({</span>
    <span class="p">...</span>
    <span class="na">webPreferences</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">preload</span><span class="p">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">"</span><span class="s2">preload.js</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">});</span>
</code></pre></div></div>

<p>Ce script a accès à NodeJS et va nous servir de passerelle entre le processus principal et celui de rendu de la fenêtre courante. Le but de ce script est d’implémenter le principe de moindre privilège. On va pouvoir étendre les capacités du processus de rendu avec ce qui est seulement nécessaire.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// preload.js</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">contextBridge</span><span class="p">,</span><span class="nx">ipcRenderer</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">electron</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">contextBridge</span><span class="p">.</span><span class="nx">exposeInMainWorld</span><span class="p">(</span>
    <span class="dl">"</span><span class="s2">api</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">send</span><span class="p">:</span> <span class="p">(</span><span class="nx">channel</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">ipcRenderer</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">channel</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="na">receive</span><span class="p">:</span> <span class="p">(</span><span class="nx">channel</span><span class="p">,</span> <span class="nx">func</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">ipcRenderer</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">channel</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="p">...</span><span class="nx">args</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">func</span><span class="p">(...</span><span class="nx">args</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">);</span>
</code></pre></div></div>

<p>Grâce à cela notre processus de rendu a maintenant accès à une nouvelle interface <em>api</em>.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//index.html</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">api</span><span class="p">.</span><span class="nx">receive</span><span class="p">(</span><span class="dl">"</span><span class="s2">channel</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Received </span><span class="p">${</span><span class="nx">data</span><span class="p">}</span><span class="s2"> from main process`</span><span class="p">);</span>
<span class="p">});</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">api</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">"</span><span class="s2">channel</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">some data</span><span class="dl">"</span><span class="p">);</span>
</code></pre></div></div>

<p>Pour comprendre un peu mieux le sujet sur la sécurité, la communication inter-processus, le principe de moindre responsabilité ainsi que le preloading il y a un <a href="https://github.com/electron/electron/issues/9920#issuecomment-575839738">excellent commentaire</a> sur le sujet et un <a href="https://github.com/reZach/secure-electron-template/blob/master/docs/secureapps.md#building-a-secure-app">fichier Markdown</a>.</p>

<h2 id="tests--debug">Tests &amp; Debug</h2>

<p>Il existe plusieurs moyens de tester et debugger son application Electron. Je survole le sujet.</p>

<ul>
  <li><a href="https://developers.google.com/web/tools/chrome-devtools">Chrome DevTools</a> pour analyser son rendu, comme sur un site web classique</li>
  <li><a href="https://www.electronjs.org/docs/tutorial/debugging-vscode">Debugger avec VSCode</a></li>
  <li><a href="https://jestjs.io/">Tests unitaires avec Jest</a></li>
  <li><a href="https://www.electronjs.org/docs/tutorial/using-selenium-and-webdriver">Tests d’intégration</a></li>
</ul>

<h2 id="packager-et-publier-son-application">Packager et publier son application</h2>

<p>Electron Forge fournit plusieurs utilitaires pour aider à partager son application.</p>

<ul>
  <li><a href="https://www.electronforge.io/config/makers">https://www.electronforge.io/config/makers</a></li>
  <li><a href="https://www.electronforge.io/config/publishers">https://www.electronforge.io/config/publishers</a></li>
</ul>

<h2 id="aller-plus-loin">Aller plus loin</h2>

<p>La <a href="https://www.electronjs.org/docs">documentation officielle</a> d’Electron est <strong>très complète</strong>. Toute l’API du framework est disponible. La <a href="https://www.electronjs.org/docs/tutorial">section tutoriel</a> couvrira la plupart des besoins en terme de développement.</p>

<p>Voici une liste d’applications développées avec Electron que j’utilise au quotidien sur différents systèmes et qui fonctionnent bien:</p>

<ul>
  <li>Slack</li>
  <li>Discord</li>
  <li>Notion</li>
  <li>VSCode</li>
  <li>WhatsApp</li>
  <li>Twitch</li>
  <li>Figma</li>
  <li>…</li>
</ul>

<h2 id="conclusion">Conclusion</h2>

<p>L’initialisation d’une nouvelle application et la voir fonctionner en seulement deux commandes est très appréciable.</p>

<p><strong>La promesse du multi platformes à l’air vraiment d’être tenue</strong>. Je pense qu’il y a forcément des exceptions mais l’impression que j’en ai jusque là est bonne.</p>

<p>L’expérience développeur est agréable aussi. La maturité grandissante de l’écosystème JavaScript aide en ce sens. L’utilisation de TypeScript ou Webpack par exemple est un gros plus. Il est possible d’utiliser des frameworks front tel que React ou Vue si besoin.</p>

<p>Un développeur JavaScript n’aura absolument <strong>aucun mal à prendre en main</strong> le framework.</p>

<p>Il y a quand même quelques notions difficiles à appréhender. Malgré que l’on retrouve vite nos habitudes de développeur web, <strong>l’environnement est différent et impose des contraintes différentes</strong>.</p>

<p>Globalement l’expérience est très positive et jusque là je ne vois aucune raison de ne pas utiliser Electron comme framework de développement d’application de bureau !</p>

</article>


  <div class="share-page">
  Objectivement, tu <u>dois</u> partager

  <div class="share-links">
    
      <a class = "fa fa-facebook" href="https://facebook.com/sharer.php?u=https://qpautrat.github.io/2020/12/15/debuter-avec-electron/" rel="nofollow" target="_blank" title="Share on Facebook"></a>
    

    
      

      <a class="fa fa-twitter" href="https://twitter.com/intent/tweet?text=Débuter avec Electron via @pautrat%0A %23Electron %23JavaScript %23NodeJS%0A&url=https://qpautrat.github.io/2020/12/15/debuter-avec-electron/" rel="nofollow" target="_blank" title="Share on Twitter"></a>
    

    

    
      <a class="fa fa-linkedin" href="http://www.linkedin.com/shareArticle?url=https://qpautrat.github.io/2020/12/15/debuter-avec-electron/&title=Débuter avec Electron" rel="nofollow" target="_blank" title="Share on LinkedIn"></a>
    

    

    

    

    
  </div>
</div>









      </div>
    </div>
  </div>

  <footer class="footer">
  <div class="p2 wrap">
    <div class="measure mt1 center">
      <small>
        Crafted with &lt;3 by <a href="http://johnotander.com">John Otander</a> (<a href="https://twitter.com/4lpine">@4lpine</a>).<br>
        &lt;/&gt; available on <a href="https://github.com/johnotander/pixyll">Github</a>.
      </small>
    </div>
  </div>
</footer>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-49889834-2', 'auto');
ga('send', 'pageview');

</script>


</body>
</html>
